<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UOBK EDA (Live CSV)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js" crossorigin="anonymous"></script>
  <style>
    :root { --bg:#fff; --text:#111827; --muted:#6b7280; --border:#e5e7eb; --thead:#f3f4f6; }
    *{box-sizing:border-box}
    body{margin:1rem;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:var(--bg)}
    header{margin:0 0 1rem}
    h1{margin:.2rem 0;font-size:clamp(1.4rem,2.2vw,2rem)}
    .sub{color:var(--muted)}
    .card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:1rem}
    .kpis{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.75rem;margin:.75rem 0}
    .kpi{padding:.8rem;border:1px solid var(--border);border-radius:10px;background:#fafafa}
    .kpi .v{font-weight:700;font-size:1.15rem}
    .row{display:grid;gap:1rem}
    @media(min-width:1000px){.row{grid-template-columns:2fr 1fr}}
    .table-wrap{overflow:auto}
    table{border-collapse:collapse;width:100%;min-width:720px}
    th,td{border:1px solid var(--border);padding:.55rem .6rem;text-align:left;vertical-align:top}
    thead th{background:var(--thead)}
    .muted{color:var(--muted)}
    .found{color:#065f46}
    .notfound{color:#991b1b}
    .footer{margin-top:1rem;color:var(--muted)}
    canvas{max-height:520px}
    .err{margin-top:.8rem;padding:.7rem .9rem;border:1px solid #fecaca;background:#fef2f2;color:#7f1d1d;border-radius:10px;white-space:pre-wrap}
  </style>
</head>
<body>
  <header>
    <h1>Simple EDA: UOBK (Live CSV)</h1>
    <div class="sub">CSV: <code id="src"></code> • Dimuat: <span id="ts"></span></div>
  </header>

  <section class="card">
    <div class="kpis">
      <div class="kpi"><div class="t">TOTAL rows (Row_Count)</div><div id="kpiRows" class="v">-</div></div>
      <div class="kpi"><div class="t">Unique UOBK</div><div id="kpiUnique" class="v">-</div></div>
    </div>

    <div class="row">
      <div class="card" style="padding:1rem">
        <h3 style="margin-top:0">Bar Chart — Row Counts per UOBK</h3>
        <canvas id="barChart"></canvas>
      </div>
      <div class="card" style="padding:1rem">
        <h3 style="margin-top:0">Reference UOBK List Check</h3>
        <div class="muted" style="margin:.25rem 0 .5rem">Hanya memeriksa nama UOBK; tidak menampilkan NIP.</div>
        <div><strong>Found (dengan jumlah baris):</strong><ul id="refFound" class="found"></ul></div>
        <div style="margin-top:.6rem"><strong>Not Found:</strong><ul id="refNotFound" class="notfound"></ul></div>
      </div>
    </div>

    <div class="card" style="margin-top:1rem">
      <h3 style="margin-top:0">Tabel — Counts per UOBK</h3>
      <div class="table-wrap">
        <table>
          <thead><tr><th>UOBK</th><th>Row_Count</th><th>Percentage</th></tr></thead>
          <tbody id="tblBody"></tbody>
        </table>
      </div>
      <div id="msg" class="footer"></div>
      <div id="err" class="err" style="display:none"></div>
    </div>
  </section>

  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5C1wkIPrNoBRwRaDohzVFT6wfeX0lfSl2BTCUpDcQwiuQtgkybGjcmzKl7LBu7g/pub?gid=1021451323&single=true&output=csv";
    const REFERENCE_UOBK = [
      "RS JIWA MENUR","RS MATA MASYARAKAT JAWA TIMUR","RS PARU JEMBER",
      "RS PARU MANGUHARJO PROVINSI JAWA TIMUR","RSUD DAHA HUSADA","RSUD DR. SAIFUL ANWAR",
      "RSUD DR. SOEDONO MADIUN","RSUD DR. SOETOMO","RSUD DUNGUS",
      "RSUD HAJI PROVINSI JAWA TIMUR","RSUD HUSADA PRIMA","RSUD KARSA HUSADA BATU",
      "RSUD MOHAMMAD NOER PAMEKASAN","RSUD SUMBERGLAGAH"
    ];

    const $ = (s)=>document.querySelector(s);
    const src = $("#src"), ts = $("#ts"), kpiRows = $("#kpiRows"), kpiUnique = $("#kpiUnique");
    const tblBody = $("#tblBody"), msg = $("#msg"), refFound = $("#refFound"), refNotFound = $("#refNotFound");
    const errBox = $("#err"), barCanvas = document.g
